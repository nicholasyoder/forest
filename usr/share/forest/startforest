#!/bin/sh

export XDG_DATA_DIRS="/usr/local/share/:/usr/share/:/usr/share/gdm/:/var/lib/menu-xdg/"

if [ -z "$XDG_CONFIG_HOME" ]; then
	export XDG_CONFIG_HOME="$HOME/.config"
fi

if [ -z "$XDG_DATA_HOME" ]; then
	export XDG_DATA_HOME="$HOME/.local/share"
fi

# Ensure the existance of xfwm4 config file
XFWM4_CONF_DIR="$XDG_CONFIG_HOME/xfce4/xfconf/xfce-perchannel-xml"
if [ ! -f "$XFWM4_CONF_DIR/xfwm4.xml" ]; then
	mkdir -p "$XFWM4_CONF_DIR"
	cp /usr/share/forest/xfwm4.xml "$XFWM4_CONF_DIR/xfwm4.xml"
fi

# Set qt5ct settings
QT5CT_CONF_DIR="$XDG_CONFIG_HOME/qt5ct"
if [ ! -f "$QT5CT_CONF_DIR/qt5ct.conf" ]; then
	mkdir -p "$QT5CT_CONF_DIR"
	cp /usr/share/forest/qt5ct.conf "$QT5CT_CONF_DIR/qt5ct.conf"
fi

# Setup gtk-2.0 themes
GTK2_CONF_FILE="$XDG_CONFIG_HOME/.gtkrc-2.0"
if [ ! -f "$GTK2_CONF_FILE" ]; then
	cat << EOF
# Autogenerated by Forest

gtk-theme-name="Forest"
gtk-icon-theme-name="Papirus"
gtk-font-name="Sans 10"
gtk-cursor-theme-name="Adwaita"
gtk-cursor-theme-size=0

EOF
fi

# Clean up after GDM (GDM sets the number of desktops to one)
xprop -root -remove _NET_NUMBER_OF_DESKTOPS -remove _NET_DESKTOP_NAMES -remove _NET_CURRENT_DESKTOP 2> /dev/null

#export XDG_MENU_PREFIX="forest-"
export XDG_CURRENT_DESKTOP="Forest"
export QT_QPA_PLATFORMTHEME="qt5ct"

# Start the Forest session
exec forest-session